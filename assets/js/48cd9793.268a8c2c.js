"use strict";(self.webpackChunksrc_dev=self.webpackChunksrc_dev||[]).push([[623],{1495:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var i=t(5893),s=t(1151);const r={title:"Authentication \u5982\u4f55\u8a2d\u5b9a\u767d\u540d\u55ae"},o=void 0,c={id:"firebase_gcp/authentication-with-identity-platform",title:"Authentication \u5982\u4f55\u8a2d\u5b9a\u767d\u540d\u55ae",description:"\u672c\u7bc7\u7d00\u9304 Authentication \u5982\u4f55\u8a2d\u5b9a\u767d\u540d\u55ae\uff0c\u4ee5\u78ba\u4fdd\u53ea\u6709\u5728\u767d\u540d\u55ae\u5167\u7684\u5e33\u865f\u624d\u53ef\u4ee5\u767b\u5165\u3002",source:"@site/docs/firebase_gcp/authentication-with-identity-platform.md",sourceDirName:"firebase_gcp",slug:"/firebase_gcp/authentication-with-identity-platform",permalink:"/src.dev/firebase_gcp/authentication-with-identity-platform",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Authentication \u5982\u4f55\u8a2d\u5b9a\u767d\u540d\u55ae"},sidebar:"tutorialSidebar",previous:{title:"GCP & Firebase",permalink:"/src.dev/category/gcp--firebase"},next:{title:"Firestore Security Rules \u5b89\u5168\u898f\u5247",permalink:"/src.dev/firebase_gcp/firestore-security-rules"}},a={},l=[{value:"\u5c01\u9396\u51fd\u5f0f Blocking Functions",id:"\u5c01\u9396\u51fd\u5f0f-blocking-functions",level:2},{value:"Cloud Function \u767d\u540d\u55ae\u7bc4\u4f8b",id:"cloud-function-\u767d\u540d\u55ae\u7bc4\u4f8b",level:2},{value:"\u767d\u540d\u55ae\u8cc7\u6599\u64fa\u653e\u4f4d\u7f6e",id:"\u767d\u540d\u55ae\u8cc7\u6599\u64fa\u653e\u4f4d\u7f6e",level:2}];function d(e){const n={code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\u672c\u7bc7\u7d00\u9304 Authentication \u5982\u4f55\u8a2d\u5b9a\u767d\u540d\u55ae\uff0c\u4ee5\u78ba\u4fdd\u53ea\u6709\u5728\u767d\u540d\u55ae\u5167\u7684\u5e33\u865f\u624d\u53ef\u4ee5\u767b\u5165\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u56e0\u70ba Firebase Authentication \u6709\u8ddf Google Cloud Identity Platform \u505a\u6574\u5408\uff0c\u56e0\u6b64\u53ef\u4ee5\u5229\u7528 Identity Platform \u7684 \u201c\u5c01\u9396\u51fd\u5f0f(Blocking Functions)\u201d \u4f86\u63a7\u5236 User \u7684\u767b\u5165\u904e\u7a0b\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5c01\u9396\u51fd\u5f0f-blocking-functions",children:"\u5c01\u9396\u51fd\u5f0f Blocking Functions"}),"\n",(0,i.jsx)(n.p,{children:"\u5728 Identity Platform \u4e2d\uff0c\u5c01\u9396\u51fd\u5f0f\u5141\u8a31\u5728\u7528\u6236\u7684\u8a8d\u8b49\u751f\u547d\u9031\u671f\u4e2d\u7684\u7279\u5b9a\u6642\u523b\u904b\u884c\u81ea\u5b9a\u7fa9\u908f\u8f2f\u3002\u9019\u4e9b\u51fd\u6578\u53ef\u4ee5\u5728\u7528\u6236\u767b\u9304\u3001\u8a3b\u518a\u3001\u522a\u9664\u8cec\u6236\u7b49\u4e8b\u4ef6\u767c\u751f\u6642\u89f8\u767c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5275\u5efa\u5c01\u9396\u51fd\u5f0f\u7684\u6d41\u7a0b\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8a2d\u7f6e Cloud Function\uff1a \u9996\u5148\uff0c\u60a8\u9700\u8981\u5728 Google Cloud Functions \u4e2d\u5275\u5efa\u4e00\u500b\u65b0\u51fd\u6578\u3002\u9019\u500b\u51fd\u6578\u5c07\u5305\u542b\u60a8\u60f3\u8981\u5728\u7528\u6236\u767b\u5165\u6216\u8a3b\u518a\u6642\u57f7\u884c\u7684\u908f\u8f2f\u3002"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5b9a\u7fa9\u5c01\u9396\u884c\u70ba\uff1a \u5728\u9019\u500b\u51fd\u6578\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5b9a\u7fa9\u7279\u5b9a\u7684\u908f\u8f2f\u4f86\u6c7a\u5b9a\u662f\u5426\u5141\u8a31\u7528\u6236\u767b\u5165\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6aa2\u67e5\u7528\u6236\u662f\u5426\u88ab\u5c01\u7981\u3001\u8cec\u6236\u662f\u5426\u5df2\u9a57\u8b49\u3001\u6216\u662f\u5426\u7b26\u5408\u5176\u4ed6\u81ea\u5b9a\u7fa9\u689d\u4ef6\u3002"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u914d\u7f6e Identity Platform\uff1a \u5728 Identity Platform \u8a2d\u7f6e\u4e2d\uff0c\u60a8\u5c07\u6307\u5b9a\u4f55\u6642\u89f8\u767c\u9019\u500b\u51fd\u6578\u3002\u60a8\u53ef\u4ee5\u9078\u64c7\u5728\u767b\u5165\u524d\u3001\u8a3b\u518a\u524d\u7b49\u4e0d\u540c\u7684\u8eab\u4efd\u9a57\u8b49\u968e\u6bb5\u89f8\u767c\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cloud-function-\u767d\u540d\u55ae\u7bc4\u4f8b",children:"Cloud Function \u767d\u540d\u55ae\u7bc4\u4f8b"}),"\n",(0,i.jsxs)(n.p,{children:["\u6b64\u7bc4\u4f8b\u5beb\u4e86\u5169\u500b\u51fd\u6578 ",(0,i.jsx)(n.code,{children:"validatenewuser"})," ",(0,i.jsx)(n.code,{children:"validatesignedinuser"})," \u5206\u5225\u5728 ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"\u65b0\u7528\u6236\u8a3b\u518a\u524d"})})," \u4ee5\u53ca ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"\u6bcf\u6b21\u7528\u6236\u767b\u5165\u524d"})})," \u57f7\u884c\uff0c\n\u57f7\u884c\u5167\u5bb9\u70ba\u6aa2\u67e5\u8a72\u7528\u6236\u7684 email \u662f\u5426\u5728\u767d\u540d\u55ae\u5167\uff0c\u82e5\u5728\u767d\u540d\u55ae\u5167\u5247\u901a\u904e\uff0c\u5426\u5247\u56de\u50b3 ",(0,i.jsx)(n.code,{children:"Unauthorized email"}),"\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from firebase_functions import identity_fn, https_fn\nfrom firebase_admin import initialize_app\n\ninitialize_app()\n\nwhitelist = [\n    "granted_user_01@google.com",\n    "granted_user_02@google.com",\n    "granted_user_03@google.com",\n]\n\n\n@identity_fn.before_user_created()\ndef validatenewuser(\n    event: identity_fn.AuthBlockingEvent,\n) -> identity_fn.BeforeCreateResponse | None:\n\n    # User data passed in from the CloudEvent.\n    user = event.data\n\n    # Only users in the whitelist can sign up.\n    if user.email is None or user.email not in whitelist:\n        # Return None so that Firebase Auth rejects the account creation.\n        raise https_fn.HttpsError(\n            code=https_fn.FunctionsErrorCode.INVALID_ARGUMENT,\n            message="Unauthorized email",\n        )\n\n\n@identity_fn.before_user_signed_in()\ndef validatesignedinuser(\n    event: identity_fn.AuthBlockingEvent,\n) -> identity_fn.BeforeSignInResponse | None:\n\n    # User data passed in from the CloudEvent.\n    user = event.data\n\n    # Only users in the whitelist can sign in.\n    if user.email is None or user.email not in whitelist:\n        # Return None so that Firebase Auth rejects the account creation.\n        raise https_fn.HttpsError(\n            code=https_fn.FunctionsErrorCode.INVALID_ARGUMENT,\n            message="Unauthorized email",\n        )\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u90e8\u7f72\u81f3 Cloud Functions \u5f8c\uff0c\u518d\u5230 Firebase Authentication \u7684 Settings \u9801\u9762\uff0c\u9078\u64c7\u6b63\u78ba\u7684\u5c01\u9396\u51fd\u5f0f\uff0c\u5c31\u53ef\u4ee5\u9054\u6210\u767d\u540d\u55ae\u7684\u6548\u679c\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"authentication-001",src:t(3677).Z+"",width:"1926",height:"1328"})}),"\n",(0,i.jsx)(n.h2,{id:"\u767d\u540d\u55ae\u8cc7\u6599\u64fa\u653e\u4f4d\u7f6e",children:"\u767d\u540d\u55ae\u8cc7\u6599\u64fa\u653e\u4f4d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u5be6\u52d9\u4e0a\u56e0\u70ba\u767d\u540d\u55ae\u6709\u53ef\u80fd\u6703\u8b8a\u52d5\uff0c\u6b64\u6642\u5c31\u4e0d\u5efa\u8b70\u628a\u767d\u540d\u55ae\u5beb\u6b7b\u5728 Cloud Function \u5167\u90e8\uff0c\u56e0\u70ba\u6bcf\u4e00\u6b21\u7684\u4fee\u6539\u90fd\u8981\u91cd\u65b0\u90e8\u7f72\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u8003\u616e\u5c07\u767d\u540d\u55ae\u653e\u5728\u5176\u4ed6\u5730\u65b9\uff08\u4f8b\u5982 Firestore Database\uff09\uff0c\u7136\u5f8c\u5728\u57f7\u884c Cloud Function \u6642\u53bb\u8b80\u53d6\u5916\u90e8\u7684\u767d\u540d\u55ae\u8cc7\u6599\uff0c\u9019\u6a23\u5728\u4fee\u6539\u767d\u540d\u55ae\u6642\u5c31\u4e0d\u7528\u91cd\u65b0\u90e8\u7f72\u4e86\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u4f9d\u7167\u5c08\u6848\u7684\u60c5\u6cc1\u81ea\u884c\u8a55\u4f30\u8a72\u5982\u4f55\u914d\u7f6e\u3002"})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3677:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/authentication-001-8a0efcc7659257b31c29eb9285ded8c4.png"},1151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>o});var i=t(7294);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);